<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Create Request</title>
  </head>
  <body>
    <header class="container">
        <h1>
            Create Request
        </h1>
    </header>
    <div class="container">

        <div class="mb-3">
          <label for="event-name" class="form-label">Event Name</label>
          <input type="text" id="event-name" class="form-control">
        </div>

        <div class="mb-3">
          <label for="event-description" class="form-label">Event Description</label>
          <textarea id="event-description" class="form-control" cols="30" rows="3"></textarea>
        </div>

        <div class="mb-3">
          <label for="justification" class="form-label">Why Are You Attending This Event?</label>
          <input type="text" id="justification" class="form-control">
        </div>
        
        <div class="mb-3">
          <label for="grade-type" class="form-label">How Are You Graded In This Event?</label>
          <input type="text" id="grade-type" class="form-control">
        </div>

        <div class="mb-3">
          <label for="start-date" class="form-label">Event Start Date</label>
          <input type="date" id="start-date" class="form-control">
        </div>

        <div class="mb-3">
          <label for="end-date" class="form-label">Event End Date</label>
          <input type="date" id="end-date" class="form-control">
          <div class="form-text">leave blank if event is only 1 day</div>
        </div>

        <div class="mb-3">
          <label for="missed-start" class="form-label">Missed Work Start Date</label>
          <input type="date" id="missed-start" class="form-control">
          <div class="form-text">leave blank if you won't be missing any work</div>
        </div>

        <div class="mb-3">
          <label for="missed-end" class="form-label">Missed Work End Date</label>
          <input type="date" id="missed-end" class="form-control">
          <div class="form-text">leave blank if you aren't missing any work, or only missing one day</div>
        </div>
        
        <div class="mb-3">
          <label for="cost" class="form-label">Event Cost</label>
          <div class="input-group">
            <span class="input-group-text">$</span>
            <input onchange="estimateAmount()" type="number" min="1" step="any" id="cost" class="form-control">
          </div>
        </div>

        <div class="mb-3">
          <label for="event-type" class="form-label">Event Type</label>
          <select onchange="estimateAmount()" id="event-type" class="form-select">
            <option value="1">University Course</option>
            <option value="2">Seminar</option>
            <option value="3">Certification Preperation Class</option>
            <option value="4">Certification</option>
            <option value="5">Technical Training</option>
            <option value="6">Other</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="amount">Projected Reimbursement</label>
          <div class="input-group">
            <span class="input-group-text">$</span>
            <input type="number" min="1" step="any" id="amount" class="form-control" disabled>
          </div>
        </div>
        <h2>Event Location</h2>
        <div class="mb-1">
          <label for="street" class="form-label">Street</label>
          <input type="text" id="street" class="form-control">
        </div>
        <div class="mb-1">
          <label for="city" class="form-label">City</label>
          <input type="text" id="city" class="form-control">
        </div>
        <div class="mb-1">
          <label for="state" class="form-label">State</label>
          <select id="state" class="form-select">
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="DC">District Of Columbia</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="zip" class="form-label">Zip Code</label>
          <input type="text" id="zip" class="form-control">
        </div>
        
        <div class="mb-3">
          <button onclick="submitRequest()" id="submit" class="btn btn-success">Submit Request</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <script>
      function estimateAmount() {
        cost = parseFloat(document.getElementById('cost').value);
        eventType = parseInt(document.getElementById('event-type').value);

        console.log(cost)
        console.log(eventType)
        amount = 0;
        switch (eventType) {
          case 1:
            console.log('University Course')
            // University Course
            amount = (cost * 0.8).toFixed(2);
            break;
          case 2:
            console.log('Seminar')
            // Seminar
            amount = (cost * 0.6).toFixed(2);
            break;
          case 3:
            console.log('Cert Prep Class')
            // Cert Prep Class
            amount = (cost * 0.75).toFixed(2);
            break;
          case 4:
            console.log('Certification')
            // Certification
            amount = cost.toFixed(2);
            break;
          case 5:
            // Technical Training
            amount = (cost * 0.9).toFixed(2)
            break;
          case 6:
            // Other
            amount = (cost * 0.3).toFixed(2)
            break;
        }

        document.getElementById('amount').value = amount
      }

      async function submitRequest() {
        eventName = document.getElementById('event-name').value;
        eventDescription = document.getElementById('event-description').value;
        justification = document.getElementById('justification').value;
        gradeType = document.getElementById('grade-type').value;

        startDate = new Date(document.getElementById('start-date').value).getTime();
        endDate = new Date(document.getElementById('end-date').value).getTime();
        if (isNaN(endDate)) {
          endDate = 0
        }
        missedStart = new Date(document.getElementById('missed-start').value).getTime();
        if (isNaN(missedStart)) {
          missedStart = 0
        }
        missedEnd = new Date(document.getElementById('missed-end').value).getTime();
        if (isNaN(missedEnd)) {
          missedEnd = 0
        }


        cost = document.getElementById('cost').value;
        eventType = parseInt(document.getElementById('event-type').value);
        street = document.getElementById('street').value;
        city = document.getElementById('city').value;
        state = document.getElementById('state').value;
        zip = document.getElementById('zip').value;

        const url = 'http://localhost:5000/requests'

        data = {
          "eventStartDate": startDate,
          "eventEndDate": endDate,
          "street": street,
          "city": city,
          "state": state,
          "zipCode": zip,
          "eventName": eventName,
          "eventDescription": eventDescription,
          "eventCost": cost,
          "eventTypeId": eventType,
          "missedWorkStart": missedStart,
          "missedWorkEnd": missedEnd,
          "gradeType": gradeType,
          "justification": justification
        }

        const httpResponse = await fetch(url, {
          method: 'POST',
          headers: {
            'content-type': 'application/json'
          },
          body: JSON.stringify(data)
        })

        const body = await httpResponse.json();

        if (body) {
          location.href = `http://localhost:5000/requests/${body.requestId}`
        }
      }
    </script>
  </body>
</html>
